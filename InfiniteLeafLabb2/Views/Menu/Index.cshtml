@{
    ViewData["Title"] = "Menu";
    var menuItems = ViewBag.MenuItems as List<InfiniteLeafLabb2.Models.DTOs.MenuItemDto> ?? new List<InfiniteLeafLabb2.Models.DTOs.MenuItemDto>();
}

<!-- Menu Page Header -->
<section class="py-12 px-4">
    <div class="max-w-7xl mx-auto text-center">
        <div class="text-6xl mb-4">🍵</div>
        <h1 class="text-5xl md:text-6xl font-bold text-white mb-4">
            Our Tea Collection
        </h1>
        <p class="text-xl text-gray-400 max-w-2xl mx-auto">
            Explore our carefully curated selection of premium teas from around the world
        </p>
    </div>
</section>

<!-- Search and Filter Section -->
<section class="p-4">
    <div class="max-w-7xl mx-auto">
        <div class="rounded-2xl p-6"
             style="background-color: rgba(39, 57, 28, 0.4); border: 2px solid rgba(37, 95, 56, 0.3); backdrop-filter: blur(12px);">

            <!-- Search Bar -->
            <div class="mb-6">
                <div class="relative max-w-2xl mx-auto">
                    <input type="text"
                           id="search-input"
                           placeholder="Search for your favorite tea..."
                           class="w-full px-6 py-4 pr-12 rounded-xl text-lg transition-all duration-300 focus:ring-2 focus:ring-emerald-500 outline-none"
                           style="background-color: #18230F; border: 1px solid rgba(37, 95, 56, 0.5); color: #FFFFFF;">
                    <div class="absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl text-emerald-500">
                        🔍
                    </div>
                </div>
            </div>

            <!-- Filter Buttons -->
            <div class="flex flex-wrap gap-3 justify-center">
                <button id="btn-all"
                        class="filter-btn active px-6 py-3 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105"
                        data-filter="all">
                    <span class="mr-2">📋</span>
                    All Items
                </button>
                <button id="btn-popular"
                        class="filter-btn px-6 py-3 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105"
                        data-filter="popular">
                    <span class="mr-2">⭐</span>
                    Popular Items
                </button>
            </div>
        </div>
    </div>
</section>

<!-- Menu Items Grid -->
<section class="p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-20 rounded-2xl"
             style="background-color: rgba(39, 57, 28, 0.4); border: 2px solid rgba(37, 95, 56, 0.3);">
            <div class="text-6xl mb-4">🔍</div>
            <p class="text-xl text-gray-400 mb-2">No items found</p>
            <p class="text-gray-500">Try adjusting your search or filter</p>
        </div>

        <!-- Menu Items Container -->
        <div id="menu-items-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            @if (menuItems.Any())
            {
                @foreach (var item in menuItems)
                {
                    <div class="menu-item-card rounded-2xl p-6 transition-all duration-300 hover:scale-105 group"
                         data-name="@item.Name.ToLower()"
                         data-description="@item.Description.ToLower()"
                         data-popular="@item.IsPopular.ToString().ToLower()"
                         style="background-color: rgba(39, 57, 28, 0.4); border: 2px solid rgba(37, 95, 56, 0.3); backdrop-filter: blur(12px);">

                        @if (!string.IsNullOrEmpty(item.ImageUrl))
                        {
                            <div class="mb-4 rounded-xl overflow-hidden h-48 bg-moss">
                                <img src="@item.ImageUrl"
                                     alt="@item.Name"
                                     class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                                <div style="display: none; height: 100%; align-items: center; justify-content: center; font-size: 4rem;">
                                    🍵
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="mb-4 rounded-xl h-48 bg-moss flex items-center justify-center text-6xl">
                                🍵
                            </div>
                        }

                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-xl font-bold text-emerald-400 flex-1">
                                @item.Name
                            </h3>
                            <span class="text-2xl font-bold text-emerald-500 ml-4">
                                $@item.Price.ToString("0.00")
                            </span>
                        </div>

                        <p class="text-gray-400 text-sm leading-relaxed mb-4">
                            @item.Description
                        </p>

                        <div class="flex items-center gap-2">
                            @if (item.IsPopular)
                            {
                                <span class="px-3 py-1 rounded-full text-xs font-semibold"
                                      style="background: linear-gradient(to right, rgba(37, 95, 56, 0.5), rgba(31, 125, 83, 0.5)); color: #6EE7B7;">
                                    ⭐ Popular
                                </span>
                            }
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-span-full text-center py-20 rounded-2xl"
                     style="background-color: rgba(39, 57, 28, 0.4); border: 2px solid rgba(37, 95, 56, 0.3);">
                    <div class="text-6xl mb-4">🍵</div>
                    <p class="text-xl text-gray-400">
                        Our menu is being curated. Check back soon!
                    </p>
                </div>
            }
        </div>
    </div>
</section>

@section Scripts {
    <script>
        class MenuPage {
            constructor() {
                this.currentFilter = 'all';
                this.searchQuery = '';
                this.attachEventListeners();
            }

            attachEventListeners() {
                // Filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const filter = e.currentTarget.dataset.filter;
                        this.setFilter(filter);
                    });
                });

                // Search input
                const searchInput = document.getElementById('search-input');
                searchInput.addEventListener('input', (e) => {
                    this.searchQuery = e.target.value.toLowerCase();
                    this.applyFilters();
                });
            }

            setFilter(filter) {
                this.currentFilter = filter;

                // Update active button
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-filter="${filter}"]`).classList.add('active');

                this.applyFilters();
            }

            applyFilters() {
                const cards = document.querySelectorAll('.menu-item-card');
                const emptyState = document.getElementById('empty-state');
                let visibleCount = 0;

                cards.forEach(card => {
                    const name = card.dataset.name || '';
                    const description = card.dataset.description || '';
                    const isPopular = card.dataset.popular === 'true';

                    // Apply filter
                    let matchesFilter = true;
                    if (this.currentFilter === 'popular') {
                        matchesFilter = isPopular;
                    }

                    // Apply search
                    let matchesSearch = true;
                    if (this.searchQuery) {
                        matchesSearch = name.includes(this.searchQuery) || description.includes(this.searchQuery);
                    }

                    // Show/hide card
                    if (matchesFilter && matchesSearch) {
                        card.style.display = 'block';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });

                // Show/hide empty state
                if (visibleCount === 0) {
                    emptyState.classList.remove('hidden');
                } else {
                    emptyState.classList.add('hidden');
                }
            }
        }

        // Initialize menu page when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            new MenuPage();
        });
    </script>

    <style>
        .filter-btn {
            background-color: rgba(24, 35, 15, 0.5);
            border: 1px solid rgba(37, 95, 56, 0.5);
            color: #9CA3AF;
        }

            .filter-btn:hover {
                background-color: rgba(37, 95, 56, 0.3);
                color: #D1D5DB;
            }

            .filter-btn.active {
                background: linear-gradient(to right, #255F38, #1F7D53);
                border-color: rgba(31, 125, 83, 0.5);
                color: #FFFFFF;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            }

        #search-input::placeholder {
            color: #6B7280;
        }

        #search-input:focus {
            border-color: #1F7D53;
        }

        /* Smooth card appearance */
        .menu-item-card {
            animation: fadeInUp 0.5s ease-out;
        }

        /* Add smooth gradient animation */
        @@keyframes gradient {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .bg-clip-text {
            -webkit-background-clip: text;
            background-clip: text;
        }
        
    </style>
}
